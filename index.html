<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Binomische Formeln ‚Äì Trainer</title>

<style>
body{
  font-family:system-ui,Arial;
  margin:0;padding:20px;text-align:center;
  background:linear-gradient(to bottom right,#eef2ff,#e0f7fa);
}
h1{font-size:1.8em;margin:10px 0;color:#333}
#task{font-size:1.6em;margin:15px auto;white-space:pre-line}
#result{font-size:1.1em;margin:10px;color:#000}
#score{margin:8px;color:#333}
#levelDisplay{font-weight:bold;color:#007bff;margin-bottom:5px}
#progressContainer{
  width:80%;max-width:400px;height:20px;
  background:#ddd;border-radius:10px;
  margin:10px auto 20px;overflow:hidden;display:flex;
}
.progress-segment{
  flex:1;height:100%;background:#ddd;
  transition:background-color .3s;
}
input{
  padding:10px;font-size:1.2em;width:80%;
  max-width:300px;text-align:center;
  border-radius:8px;border:1px solid #aaa;
}
button{
  background:#007bff;color:white;border:none;
  padding:10px 18px;margin:6px;border-radius:8px;cursor:pointer;
}
button:hover{background:#0056b3}
</style>
</head>

<body>

<h1>Trainer ‚Äì 3 binomische Formeln</h1>

<div id="levelDisplay">Level 1</div>
<div id="score">Lade...</div>

<div id="progressContainer"></div>

<div id="task">...</div>

<input id="answer" autocomplete="off" placeholder="L√∂sung eingeben"><br>
<button id="checkBtn">Pr√ºfen</button>
<button id="newBtn">Neue Aufgabe</button>

<p id="result"></p>

<script>
document.addEventListener("DOMContentLoaded",()=>{

// --------------------------------------------------
// Elemente
// --------------------------------------------------
const answer = document.getElementById("answer");
const task = document.getElementById("task");
const result = document.getElementById("result");
const scoreEl = document.getElementById("score");
const levelDisplay = document.getElementById("levelDisplay");
const checkBtn = document.getElementById("checkBtn");
const newBtn = document.getElementById("newBtn");
const progress = document.getElementById("progressContainer");

// --------------------------------------------------
// Variablen
// --------------------------------------------------
const VARS = ['a','b','c','x','y','u','v'];
const rc = a => a[Math.floor(Math.random()*a.length)];
const sortVars = s => s.replace(/\s+/g,'');

let correct = "";
let level = 1;
let round = 1;
let score = 0;
let total = 10;

let answered = false;
let firstTry = true;

let segments = [];

// --------------------------------------------------
// Hinweise
// --------------------------------------------------
const fixedHint = {
  1:"(a + b)¬≤ = a¬≤ + 2ab + b¬≤<br>(a - b)¬≤ = a¬≤ - 2ab + b¬≤<br>(a + b)(a - b) = a¬≤ - b¬≤",
  2:"Bei Zahl + Variable: erst Zahl und Variable wie a und b behandeln, dann Formel anwenden.",
  3:"Bei (ax + by): Koeffizienten quadrieren und im mittleren Term multiplizieren."
};

// --------------------------------------------------
// Fortschrittsbalken
// --------------------------------------------------
function initBar(){
  progress.innerHTML="";
  segments=[];
  for(let i=0;i<total;i++){
    const d=document.createElement("div");
    d.className="progress-segment";
    progress.appendChild(d);
    segments.push(d);
  }
}

// --------------------------------------------------
// Level 1 ‚Äì nur Variablen (alphabetisch)
// --------------------------------------------------
function createLevel1(){
  let a = rc(VARS), b = rc(VARS);
  if(a === b) return createLevel1();

  let vars = [a,b].sort();
  let v1 = vars[0];
  let v2 = vars[1];

  const mid = v1 + v2;
  const t = Math.floor(Math.random()*3);

  if(t===0){
    correct = `${v1}¬≤+2${mid}+${v2}¬≤`;
    return `(${v1} + ${v2})¬≤ = ?`;
  }
  if(t===1){
    correct = `${v1}¬≤-2${mid}+${v2}¬≤`;
    return `(${v1} - ${v2})¬≤ = ?`;
  }

  correct = `${v1}¬≤-${v2}¬≤`;
  return `(${v1} + ${v2}) ¬∑ (${v1} - ${v2}) = ?`;
}

// --------------------------------------------------
// Level 2 ‚Äì Zahl + Variable (alphabetisch)
// --------------------------------------------------
function createLevel2(){
  let v = rc(VARS), w = rc(VARS);
  if(v === w) return createLevel2();

  let vars = [v,w].sort();
  let v1 = vars[0];
  let v2 = vars[1];

  let n = Math.floor(Math.random()*6)+2;
  let type = Math.floor(Math.random()*3);

  const mid = v1 + v2;

  if(type===0){
    correct = `${v1}¬≤+${2*n}${mid}+${n*n}${v2}¬≤`;
    return `(${v1} + ${n}${v2})¬≤ = ?`;
  }
  if(type===1){
    correct = `${v1}¬≤-${2*n}${mid}+${n*n}${v2}¬≤`;
    return `(${v1} - ${n}${v2})¬≤ = ?`;
  }

  correct = `${v1}¬≤-${n*n}${v2}¬≤`;
  return `(${v1} + ${n}${v2}) ¬∑ (${v1} - ${n}${v2}) = ?`;
}

// --------------------------------------------------
// Level 3 ‚Äì ax + by (alphabetisch)
// --------------------------------------------------
function createLevel3(){
  let v1 = rc(VARS), v2 = rc(VARS);
  if(v1 === v2) return createLevel3();

  let vars = [v1,v2].sort();
  let x = vars[0];
  let y = vars[1];

  let a = Math.floor(Math.random()*4)+2;
  let b = Math.floor(Math.random()*4)+2;

  const mid = x + y;
  let t = Math.random()<0.7 ? 0 : 1;

  if(t===0){
    correct = `${a*a}${x}¬≤+${2*a*b}${mid}+${b*b}${y}¬≤`;
    return `(${a}${x} + ${b}${y})¬≤ = ?`;
  }

  correct = `${a*a}${x}¬≤-${b*b}${y}¬≤`;
  return `(${a}${x} + ${b}${y}) ¬∑ (${a}${x} - ${b}${y}) = ?`;
}

// --------------------------------------------------
// Level-Ende
// --------------------------------------------------
function finishLevel(){
  if(score >= 8){
    if(level < 3){
      alert(`üéâ Level ${level} geschafft!`);
      level++;
    } else {
      alert("üèÜ Alle Levels geschafft!");
    }
  } else {
    alert("‚ùå Level nicht geschafft (mind. 8 Punkte n√∂tig)");
  }

  round = 1;
  score = 0;
  segments.forEach(s=>s.style.background="#ddd");
}

// --------------------------------------------------
// Neue Aufgabe
// --------------------------------------------------
function newTask(){
  result.innerHTML="";
  answer.value="";
  answered=false;
  firstTry=true;

  if(round > total){
    finishLevel();
  }

  levelDisplay.textContent = `Level ${level}`;
  scoreEl.textContent = `Aufgabe ${round} von ${total} ‚Äì Punkte: ${score}`;

  if(level===1) task.textContent=createLevel1();
  else if(level===2) task.textContent=createLevel2();
  else task.textContent=createLevel3();
}

// --------------------------------------------------
// Pr√ºfen
// --------------------------------------------------
function check(){
  const input = answer.value.trim();
  if(!input){
    result.textContent="Bitte gib eine L√∂sung ein.";
    return;
  }

  const inpNorm = sortVars(input);
  const solNorm = sortVars(correct);

  if(answered){
    result.innerHTML =
      inpNorm===solNorm
      ? "‚úÖ Richtig ‚Äì aber kein Punkt mehr"
      : `‚ùå Falsch! Richtige L√∂sung: <b>${correct}</b>`;
    return;
  }

  answered = true;

  if(inpNorm===solNorm){
    result.textContent="‚úÖ Richtig! (+1 Punkt)";
    score++;
    segments[round-1].style.background="#4caf50";
  } else {
    result.innerHTML =
      `‚ùå Falsch! Richtige L√∂sung: <b>${correct}</b><br><br><b>Hinweis:</b><br>${fixedHint[level]}`;
    segments[round-1].style.background="#d9534f";
  }

  round++;
  scoreEl.textContent =
    `Aufgabe ${Math.min(round,total)} von ${total} ‚Äì Punkte: ${score}`;
}

// --------------------------------------------------
// Events
// --------------------------------------------------
checkBtn.onclick = check;
newBtn.onclick = newTask;
answer.addEventListener("keydown",e=>{if(e.key==="Enter")check();});

// Start
initBar();
newTask();

});
</script>

</body>
</html>
