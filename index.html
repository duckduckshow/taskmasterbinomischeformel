<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Binomische Formeln ‚Äì Trainer</title>
<style>
 body{font-family:system-ui,Arial;margin:0;padding:20px;text-align:center;background:linear-gradient(to bottom right,#eef2ff,#e0f7fa)}
 h1{margin:10px 0;font-size:1.8em;color:#333}
 #task{font-size:1.6em;margin:15px auto;white-space:pre-line}
 #result{font-size:1.1em;margin:10px;color:#000}
 #score{margin:8px;color:#333}
 #levelDisplay{font-weight:bold;color:#007bff;margin-bottom:5px}
 #progressContainer{width:80%;max-width:400px;height:20px;background:#ddd;border-radius:10px;margin:10px auto 20px;overflow:hidden;display:flex}
 .progress-segment{flex:1;height:100%;transition:background-color .3s}
 input{padding:10px;font-size:1.2em;width:80%;max-width:300px;text-align:center;border-radius:8px;border:1px solid #aaa}
 input:focus{outline:none;border-color:#007bff}
 button{background:#007bff;color:white;border:none;padding:10px 18px;margin:6px;border-radius:8px;cursor:pointer}
 button:hover{background:#0056b3}
</style>
</head>
<body>

<h1>Trainer ‚Äì 3 Binomische Formeln</h1>
<div id="levelDisplay">Level 1: Nur Variablen</div>
<div id="score">Lade...</div>
<div id="progressContainer"></div>
<div id="task">...</div>

<input id="answer" placeholder="L√∂sung eingeben" autocomplete="off"><br>
<button id="checkBtn">Pr√ºfen</button>
<button id="newBtn">Neue Aufgabe</button>

<p id="result"></p>

<script>
document.addEventListener("DOMContentLoaded",()=>{

 const answer=document.getElementById("answer");
 const task=document.getElementById("task");
 const result=document.getElementById("result");
 const scoreEl=document.getElementById("score");
 const levelDisplay=document.getElementById("levelDisplay");
 const checkBtn=document.getElementById("checkBtn");
 const newBtn=document.getElementById("newBtn");
 const progress=document.getElementById("progressContainer");

 const VARS=['a','b','c','x','y','u','v'];
 const rc=a=>a[Math.floor(Math.random()*a.length)];
 const sortVars=s=>s.replace(/\s+/g,'');

 let correct="";
 let level=1,round=1,score=0,total=10;
 let segments=[];

 // ------------------------------
 // üü© FIX: Fortschrittsbalken sauber initialisieren
 // ------------------------------
 function initBar(){
   progress.innerHTML="";
   segments=[];
   for(let i=0;i<total;i++){
     const d=document.createElement("div");
     d.className="progress-segment";
     d.style.background="#ddd";
     progress.appendChild(d);
     segments.push(d);
   }
 }

 const fixedHint={
  1:"(a + b)¬≤ = a¬≤ + 2ab + b¬≤  und  (a - b)¬≤ = a¬≤ - 2ab + b¬≤  und  (a + b)(a - b) = a¬≤ - b¬≤",
  2:"Ersetze die Zahl durch eine Konstante und wende direkt die Formel an.",
  3:"Achte auf sortierte Variablen und darauf, beide Terme zu quadrieren und das Doppelte des Produkts einzubauen."
 };

 // ---------------------------------------------
 // Level 1 ‚Äì Korrekte alphabetische Mittelterme
 // ---------------------------------------------
 function createLevel1(){
   const a=rc(VARS), b=rc(VARS);
   if(a===b) return createLevel1();

   const ab=[a,b].sort().join(""); // alphabetisch
   const type=Math.floor(Math.random()*3);

   if(type===0){
     correct=`${a}¬≤+2${ab}+${b}¬≤`;
     return `(${a}+${b})¬≤ = ?`;
   }
   if(type===1){
     correct=`${a}¬≤-2${ab}+${b}¬≤`;
     return `(${a}-${b})¬≤ = ?`;
   }

   // 3. Binomische Formel ‚Üí Malpunkte in der Aufgabenstellung
   correct=`${a}¬≤-${b}¬≤`;
   return `(${a} + ${b}) ¬∑ (${a} - ${b}) = ?`;
 }

 // ---------------------------------------------
 // Level 2 ‚Äì Zahl + Variable
 // ---------------------------------------------
 function createLevel2(){
   const a=rc(VARS), b=rc(VARS), n=Math.floor(Math.random()*5)+2;
   if(a===b) return createLevel2();

   const type=Math.floor(Math.random()*3);

   if(type===0){
     correct=`${a}¬≤+2${a}${n}${b}+${n*n}${b}¬≤`;
     return `(${a}+${n}${b})¬≤ = ?`;
   }
   if(type===1){
     correct=`${a}¬≤-2${a}${n}${b}+${n*n}${b}¬≤`;
     return `(${a}-${n}${b})¬≤ = ?`;
   }

   correct=`${a}¬≤-${n*n}${b}¬≤`;
   return `(${a}+${n}${b}) ¬∑ (${a}-${n}${b}) = ?`;
 }

 // ---------------------------------------------
 // Level 3 ‚Äì ax + by Formen
 // ---------------------------------------------
 function createLevel3(){
   const v1=rc(VARS), v2=rc(VARS);
   if(v1===v2) return createLevel3();

   const a=Math.floor(Math.random()*4)+2;
   const b=Math.floor(Math.random()*4)+2;

   const midVars=[v1,v2].sort().join("");
   const type=Math.random()<0.7?0:1;

   if(type===0){
     correct=`${a*a}${v1}¬≤+${2*a*b}${midVars}+${b*b}${v2}¬≤`;
     return `(${a}${v1} + ${b}${v2})¬≤ = ?`;
   } else {
     correct=`${a*a}${v1}¬≤-${b*b}${v2}¬≤`;
     return `(${a}${v1} + ${b}${v2}) ¬∑ (${a}${v1} - ${b}${v2}) = ?`;
   }
 }

 // ------------------------------
 // Neue Aufgabe
 // ------------------------------
 function newTask(){
   result.innerHTML="";
   answer.value="";

   if(round>total){
     alert(`Level beendet! Punkte: ${score}/${total}`);
     round=1;
     score=0;
     segments.forEach(s=>s.style.background="#ddd");
   }

   levelDisplay.textContent=`Level ${level}`;
   scoreEl.textContent=`Aufgabe ${round} von ${total} ‚Äì Punkte: ${score}`;

   if(level===1) task.textContent=createLevel1();
   else if(level===2) task.textContent=createLevel2();
   else task.textContent=createLevel3();
 }

 // ------------------------------
 // üü© FIXED CHECK: round++ nur einmal
 // ------------------------------
 function check(){
   const inp=answer.value.trim();
   if(!inp) return;

   const inpNorm=sortVars(inp);
   const solNorm=sortVars(correct);

   if(inpNorm===solNorm){
     segments[round-1].style.background="#4caf50";
     result.style.color="green";
     result.textContent="Richtig!";
     score++;
   } else {
     segments[round-1].style.background="#d9534f";
     result.style.color="black";
     result.innerHTML=`‚ùå Falsch! Richtige L√∂sung: <b>${correct}</b><br><br><b>Hinweis:</b><br>${fixedHint[level]}`;
   }

   round++;
   scoreEl.textContent=`Aufgabe ${Math.min(round,total)} von ${total} ‚Äì Punkte: ${score}`;
 }

 checkBtn.onclick=check;
 newBtn.onclick=newTask;
 answer.addEventListener("keydown",e=>{if(e.key==="Enter")check();});

 initBar();
 newTask();

});
</script>
</body>
</html>

